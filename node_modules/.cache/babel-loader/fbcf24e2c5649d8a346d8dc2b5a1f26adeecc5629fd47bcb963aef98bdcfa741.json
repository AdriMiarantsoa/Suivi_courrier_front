{"ast":null,"code":"import _regeneratorRuntime from \"/home/adrienna/Documents/Stage/Suivi_courrier_front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/adrienna/Documents/Stage/Suivi_courrier_front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { Bar } from 'vue-chartjs';\nimport { Chart as ChartJS, Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale } from 'chart.js';\nimport axios from 'axios';\n\n// Register Chart.js components\nChartJS.register(Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale);\nexport default {\n  components: {\n    BarChart: Bar\n  },\n  data: function data() {\n    return {\n      statisticsData: [],\n      departementName: '',\n      departementId: '',\n      selectedWeek: '',\n      selectedMonth: '',\n      selectedYear: '',\n      recu_par: null,\n      weeks: [],\n      formSubmitted: false\n    };\n  },\n  watch: {\n    selectedMonth: 'updateWeeks',\n    selectedYear: 'updateWeeks'\n  },\n  computed: {\n    chartData: function chartData() {\n      if (this.statisticsData.length === 0) {\n        return null;\n      }\n      var labels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\n      var data = [0, 0, 0, 0, 0, 0, 0];\n      this.statisticsData.forEach(function (item) {\n        //const adjustedIndex = (item.dayOfWeek + 6) % 7; 0 dimanche\n        var adjustedIndex = item.dayOfWeek - 1;\n        if (adjustedIndex >= 0 && adjustedIndex < 7) {\n          data[adjustedIndex] = item.courrierCount;\n        }\n      });\n      return {\n        labels: labels,\n        datasets: [{\n          label: 'Statistics of Document',\n          backgroundColor: '#42A5F5',\n          data: data\n        }]\n      };\n    },\n    chartOptions: function chartOptions() {\n      return {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            display: true\n          },\n          title: {\n            display: true\n          }\n        },\n        scales: {\n          y: {\n            beginAtZero: true,\n            ticks: {\n              stepSize: 1\n            }\n          }\n        }\n      };\n    }\n  },\n  mounted: function mounted() {\n    this.getDepartement();\n  },\n  methods: {\n    updateWeeks: function updateWeeks() {\n      if (this.selectedMonth && this.selectedYear) {\n        var weeksInMonth = this.calculateWeeksInMonth(this.selectedMonth, this.selectedYear);\n        this.weeks = Array.from({\n          length: weeksInMonth\n        }, function (_, i) {\n          return i + 1;\n        });\n      }\n    },\n    calculateWeeksInMonth: function calculateWeeksInMonth(month, year) {\n      var startDate = new Date(year, month - 1, 1);\n      var endDate = new Date(year, month, 0);\n      var startWeek = this.getWeekNumber(startDate);\n      var endWeek = this.getWeekNumber(endDate);\n      return endWeek - startWeek + 1;\n    },\n    getWeekNumber: function getWeekNumber(date) {\n      var start = new Date(date.getFullYear(), 0, 1);\n      var diff = (date - start + (start.getTimezoneOffset() - date.getTimezoneOffset()) * 60000) / 86400000;\n      return Math.ceil((diff + start.getDay() + 1) / 7);\n    },\n    getDepartement: function getDepartement() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var userresponse, recu_par, responsedept, deptresponse;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.get('http://localhost:8081/api/utilisateur', {\n                headers: {\n                  Authorization: \"Bearer \".concat(localStorage.getItem('authToken'))\n                }\n              });\n            case 3:\n              userresponse = _context.sent;\n              recu_par = userresponse.data;\n              if (recu_par) {\n                _context.next = 8;\n                break;\n              }\n              console.error(\"User  data is missing\");\n              return _context.abrupt(\"return\");\n            case 8:\n              _context.next = 10;\n              return axios.get(\"http://localhost:8081/api/departement/utilisateur/\".concat(recu_par.id_utilisateur));\n            case 10:\n              responsedept = _context.sent;\n              _this.departementId = responsedept.data;\n              _context.next = 14;\n              return axios.get(\"http://localhost:8081/api/departement/\".concat(_this.departementId));\n            case 14:\n              deptresponse = _context.sent;\n              _this.departementName = deptresponse.data;\n              _context.next = 18;\n              return _this.fetchStatistics();\n            case 18:\n              _context.next = 23;\n              break;\n            case 20:\n              _context.prev = 20;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 20]]);\n      }))();\n    },\n    fetchStatistics: function fetchStatistics() {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _this2.formSubmitted = true;\n              _context2.prev = 1;\n              _context2.next = 4;\n              return axios.get(\"http://localhost:8081/api/statistique/courriers/\".concat(_this2.departementId, \"/\").concat(_this2.selectedWeek, \"/\").concat(_this2.selectedMonth, \"/\").concat(_this2.selectedYear));\n            case 4:\n              response = _context2.sent;\n              _this2.statisticsData = response.data;\n              _context2.next = 12;\n              break;\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error('Error fetching statistics:', _context2.t0);\n              _this2.statisticsData = [];\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[1, 8]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["Bar","Chart","ChartJS","Title","Tooltip","Legend","BarElement","CategoryScale","LinearScale","axios","register","components","BarChart","data","statisticsData","departementName","departementId","selectedWeek","selectedMonth","selectedYear","recu_par","weeks","formSubmitted","watch","computed","chartData","length","labels","forEach","item","adjustedIndex","dayOfWeek","courrierCount","datasets","label","backgroundColor","chartOptions","responsive","maintainAspectRatio","plugins","legend","display","title","scales","y","beginAtZero","ticks","stepSize","mounted","getDepartement","methods","updateWeeks","weeksInMonth","calculateWeeksInMonth","Array","from","_","i","month","year","startDate","Date","endDate","startWeek","getWeekNumber","endWeek","date","start","getFullYear","diff","getTimezoneOffset","Math","ceil","getDay","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","userresponse","responsedept","deptresponse","wrap","_callee$","_context","prev","next","get","headers","Authorization","concat","localStorage","getItem","sent","console","error","abrupt","id_utilisateur","fetchStatistics","t0","stop","_this2","_callee2","response","_callee2$","_context2"],"sources":["src/pages/StatistiqueCourrierDept.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"row\">\n      <div class=\"col-12\">\n        <div class=\"card\">\n          <div class=\"card-body\">\n            <h3 style=\"color:#003366;\">{{ departementName }}</h3>\n            <h6>Statistics of the number of documents in the department</h6>\n            <form @submit.prevent=\"fetchStatistics\" class=\"form-inline\">\n              <div class=\"form-group mx-sm-3 mb-2\">\n                <label for=\"week\" class=\"mr-2\">Week:</label>\n                <select v-model=\"selectedWeek\" id=\"week\" class=\"form-control\">\n                  <option v-for=\"week in weeks\" :key=\"week\" :value=\"week\">{{ week }}</option>\n                </select>\n              </div>\n              <div class=\"form-group mx-sm-3 mb-2\">\n                <label for=\"month\" class=\"mr-2\">Month:</label>\n                <select v-model=\"selectedMonth\" id=\"month\" class=\"form-control\">\n                  <option value=\"1\">January</option>\n                  <option value=\"2\">February</option>\n                  <option value=\"3\">March</option>\n                  <option value=\"4\">April</option>\n                  <option value=\"5\">May</option>\n                  <option value=\"6\">June</option>\n                  <option value=\"7\">July</option>\n                  <option value=\"8\">August</option>\n                  <option value=\"9\">September</option>\n                  <option value=\"10\">October</option>\n                  <option value=\"11\">November</option>\n                  <option value=\"12\">December</option>\n                </select>\n              </div>\n              <div class=\"form-group mx-sm-3 mb-2\">\n                <label for=\"year\" class=\"mr-2\">Year:</label>\n                <input type=\"number\" v-model=\"selectedYear\" id=\"year\" class=\"form-control\" placeholder=\"Year\" />\n              </div>\n              <button type=\"submit\" class=\"btn btn-primary mb-2\">Fetch Statistics</button>\n            </form>\n            <bar-chart v-if=\"chartData\" :data=\"chartData\" :options=\"chartOptions\"></bar-chart>\n            <p v-else-if=\"formSubmitted && !statisticsData.length\">No couriers found for {{ selectedMonth }} {{ selectedYear }} in your department.</p>\n            <p v-else>Loading chart data...</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n  <script>\n  import { Bar } from 'vue-chartjs';\n  import { Chart as ChartJS, Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale } from 'chart.js';\n  import axios from 'axios';\n  \n  // Register Chart.js components\n  ChartJS.register(Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale);\n  \n  export default {\n    components: {\n      BarChart: Bar\n    },\n    data() {\n      return {\n        statisticsData: [],\n        departementName: '',\n        departementId: '',\n        selectedWeek: '',\n        selectedMonth: '',\n        selectedYear: '',\n        recu_par: null,\n        weeks: [],\n        formSubmitted: false\n      };\n    },\n    watch: {\n    selectedMonth: 'updateWeeks',\n    selectedYear: 'updateWeeks'\n    },\n    computed: {\n      chartData() {\n        if (this.statisticsData.length === 0) {\n          return null;\n        }\n        const labels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\n        const data = [0, 0, 0, 0, 0, 0, 0];\n\n        this.statisticsData.forEach(item => {\n        //const adjustedIndex = (item.dayOfWeek + 6) % 7; 0 dimanche\n        const adjustedIndex = item.dayOfWeek - 1;\n        if (adjustedIndex >= 0 && adjustedIndex < 7) {\n         data[adjustedIndex] = item.courrierCount;\n        }\n\n        });\n\n        return {\n          labels: labels,\n          datasets: [\n            {\n              label: 'Statistics of Document',\n              backgroundColor: '#42A5F5',\n              data: data\n            }\n          ]\n        };\n      },\n      chartOptions() {\n        return {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              display: true\n            },\n            title: {\n              display: true,\n            }\n          },\n          scales: {\n            y: {\n              beginAtZero: true,\n              ticks: {\n                stepSize: 1 \n              }\n            }\n          }\n        };\n      }\n    },\n    mounted() {\n      this.getDepartement();\n    },\n    methods: {\n      updateWeeks() {\n          if (this.selectedMonth && this.selectedYear) {\n            const weeksInMonth = this.calculateWeeksInMonth(this.selectedMonth, this.selectedYear);\n            this.weeks = Array.from({ length: weeksInMonth }, (_, i) => i + 1);\n          }\n      },\n      calculateWeeksInMonth(month, year) {\n          const startDate = new Date(year, month - 1, 1);\n          const endDate = new Date(year, month, 0);\n          const startWeek = this.getWeekNumber(startDate);\n          const endWeek = this.getWeekNumber(endDate);\n          return endWeek - startWeek + 1;\n      },\n      getWeekNumber(date) {\n          const start = new Date(date.getFullYear(), 0, 1);\n          const diff = (date - start + (start.getTimezoneOffset() - date.getTimezoneOffset()) * 60000) / 86400000;\n          return Math.ceil((diff + start.getDay() + 1) / 7);\n      },\n      async getDepartement() {\n            try {\n            const userresponse = await axios.get('http://localhost:8081/api/utilisateur', {\n                headers: {\n                Authorization: `Bearer ${localStorage.getItem('authToken')}`,\n                },\n            });\n            const recu_par = userresponse.data; \n            if (!recu_par) {\n                console.error(\"User  data is missing\");\n                return;\n            }\n            const responsedept = await axios.get(`http://localhost:8081/api/departement/utilisateur/${recu_par.id_utilisateur}`);\n            this.departementId = responsedept.data;\n\n            const deptresponse = await axios.get(`http://localhost:8081/api/departement/${this.departementId}`);\n            this.departementName = deptresponse.data;\n\n            await this.fetchStatistics(); \n\n            } catch (error) {\n            console.error(error);\n            }\n        },\n        async fetchStatistics() {\n            this.formSubmitted = true;\n            try {\n            const response = await axios.get(`http://localhost:8081/api/statistique/courriers/${this.departementId}/${this.selectedWeek}/${this.selectedMonth}/${this.selectedYear}`);\n            this.statisticsData = response.data;\n            } catch (error) {\n                console.error('Error fetching statistics:', error);\n                this.statisticsData = [];\n            }\n        }\n    }\n  };\n  </script>\n\n<style scoped>\n  .form-inline {\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n  }\n\n  .form-group {\n    margin-right: 15px;\n  }\n\n  .btn {\n    margin-left: 10px;\n  }\n</style>"],"mappings":";;;;;;;AAiDA,SAAAA,GAAA;AACA,SAAAC,KAAA,IAAAC,OAAA,EAAAC,KAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,UAAA,EAAAC,aAAA,EAAAC,WAAA;AACA,OAAAC,KAAA;;AAEA;AACAP,OAAA,CAAAQ,QAAA,CAAAP,KAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,UAAA,EAAAC,aAAA,EAAAC,WAAA;AAEA;EACAG,UAAA;IACAC,QAAA,EAAAZ;EACA;EACAa,IAAA,WAAAA,KAAA;IACA;MACAC,cAAA;MACAC,eAAA;MACAC,aAAA;MACAC,YAAA;MACAC,aAAA;MACAC,YAAA;MACAC,QAAA;MACAC,KAAA;MACAC,aAAA;IACA;EACA;EACAC,KAAA;IACAL,aAAA;IACAC,YAAA;EACA;EACAK,QAAA;IACAC,SAAA,WAAAA,UAAA;MACA,SAAAX,cAAA,CAAAY,MAAA;QACA;MACA;MACA,IAAAC,MAAA;MACA,IAAAd,IAAA;MAEA,KAAAC,cAAA,CAAAc,OAAA,WAAAC,IAAA;QACA;QACA,IAAAC,aAAA,GAAAD,IAAA,CAAAE,SAAA;QACA,IAAAD,aAAA,SAAAA,aAAA;UACAjB,IAAA,CAAAiB,aAAA,IAAAD,IAAA,CAAAG,aAAA;QACA;MAEA;MAEA;QACAL,MAAA,EAAAA,MAAA;QACAM,QAAA,GACA;UACAC,KAAA;UACAC,eAAA;UACAtB,IAAA,EAAAA;QACA;MAEA;IACA;IACAuB,YAAA,WAAAA,aAAA;MACA;QACAC,UAAA;QACAC,mBAAA;QACAC,OAAA;UACAC,MAAA;YACAC,OAAA;UACA;UACAC,KAAA;YACAD,OAAA;UACA;QACA;QACAE,MAAA;UACAC,CAAA;YACAC,WAAA;YACAC,KAAA;cACAC,QAAA;YACA;UACA;QACA;MACA;IACA;EACA;EACAC,OAAA,WAAAA,QAAA;IACA,KAAAC,cAAA;EACA;EACAC,OAAA;IACAC,WAAA,WAAAA,YAAA;MACA,SAAAjC,aAAA,SAAAC,YAAA;QACA,IAAAiC,YAAA,QAAAC,qBAAA,MAAAnC,aAAA,OAAAC,YAAA;QACA,KAAAE,KAAA,GAAAiC,KAAA,CAAAC,IAAA;UAAA7B,MAAA,EAAA0B;QAAA,aAAAI,CAAA,EAAAC,CAAA;UAAA,OAAAA,CAAA;QAAA;MACA;IACA;IACAJ,qBAAA,WAAAA,sBAAAK,KAAA,EAAAC,IAAA;MACA,IAAAC,SAAA,OAAAC,IAAA,CAAAF,IAAA,EAAAD,KAAA;MACA,IAAAI,OAAA,OAAAD,IAAA,CAAAF,IAAA,EAAAD,KAAA;MACA,IAAAK,SAAA,QAAAC,aAAA,CAAAJ,SAAA;MACA,IAAAK,OAAA,QAAAD,aAAA,CAAAF,OAAA;MACA,OAAAG,OAAA,GAAAF,SAAA;IACA;IACAC,aAAA,WAAAA,cAAAE,IAAA;MACA,IAAAC,KAAA,OAAAN,IAAA,CAAAK,IAAA,CAAAE,WAAA;MACA,IAAAC,IAAA,IAAAH,IAAA,GAAAC,KAAA,IAAAA,KAAA,CAAAG,iBAAA,KAAAJ,IAAA,CAAAI,iBAAA;MACA,OAAAC,IAAA,CAAAC,IAAA,EAAAH,IAAA,GAAAF,KAAA,CAAAM,MAAA;IACA;IACAxB,cAAA,WAAAA,eAAA;MAAA,IAAAyB,KAAA;MAAA,OAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;QAAA,IAAAC,YAAA,EAAA3D,QAAA,EAAA4D,YAAA,EAAAC,YAAA;QAAA,OAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAEA7E,KAAA,CAAA8E,GAAA;gBACAC,OAAA;kBACAC,aAAA,YAAAC,MAAA,CAAAC,YAAA,CAAAC,OAAA;gBACA;cACA;YAAA;cAJAb,YAAA,GAAAK,QAAA,CAAAS,IAAA;cAKAzE,QAAA,GAAA2D,YAAA,CAAAlE,IAAA;cAAA,IACAO,QAAA;gBAAAgE,QAAA,CAAAE,IAAA;gBAAA;cAAA;cACAQ,OAAA,CAAAC,KAAA;cAAA,OAAAX,QAAA,CAAAY,MAAA;YAAA;cAAAZ,QAAA,CAAAE,IAAA;cAAA,OAGA7E,KAAA,CAAA8E,GAAA,sDAAAG,MAAA,CAAAtE,QAAA,CAAA6E,cAAA;YAAA;cAAAjB,YAAA,GAAAI,QAAA,CAAAS,IAAA;cACAnB,KAAA,CAAA1D,aAAA,GAAAgE,YAAA,CAAAnE,IAAA;cAAAuE,QAAA,CAAAE,IAAA;cAAA,OAEA7E,KAAA,CAAA8E,GAAA,0CAAAG,MAAA,CAAAhB,KAAA,CAAA1D,aAAA;YAAA;cAAAiE,YAAA,GAAAG,QAAA,CAAAS,IAAA;cACAnB,KAAA,CAAA3D,eAAA,GAAAkE,YAAA,CAAApE,IAAA;cAAAuE,QAAA,CAAAE,IAAA;cAAA,OAEAZ,KAAA,CAAAwB,eAAA;YAAA;cAAAd,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAe,EAAA,GAAAf,QAAA;cAGAU,OAAA,CAAAC,KAAA,CAAAX,QAAA,CAAAe,EAAA;YAAA;YAAA;cAAA,OAAAf,QAAA,CAAAgB,IAAA;UAAA;QAAA,GAAAtB,OAAA;MAAA;IAEA;IACAoB,eAAA,WAAAA,gBAAA;MAAA,IAAAG,MAAA;MAAA,OAAA1B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,UAAAyB,SAAA;QAAA,IAAAC,QAAA;QAAA,OAAA3B,mBAAA,GAAAM,IAAA,UAAAsB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAApB,IAAA,GAAAoB,SAAA,CAAAnB,IAAA;YAAA;cACAe,MAAA,CAAA/E,aAAA;cAAAmF,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAnB,IAAA;cAAA,OAEA7E,KAAA,CAAA8E,GAAA,oDAAAG,MAAA,CAAAW,MAAA,CAAArF,aAAA,OAAA0E,MAAA,CAAAW,MAAA,CAAApF,YAAA,OAAAyE,MAAA,CAAAW,MAAA,CAAAnF,aAAA,OAAAwE,MAAA,CAAAW,MAAA,CAAAlF,YAAA;YAAA;cAAAoF,QAAA,GAAAE,SAAA,CAAAZ,IAAA;cACAQ,MAAA,CAAAvF,cAAA,GAAAyF,QAAA,CAAA1F,IAAA;cAAA4F,SAAA,CAAAnB,IAAA;cAAA;YAAA;cAAAmB,SAAA,CAAApB,IAAA;cAAAoB,SAAA,CAAAN,EAAA,GAAAM,SAAA;cAEAX,OAAA,CAAAC,KAAA,+BAAAU,SAAA,CAAAN,EAAA;cACAE,MAAA,CAAAvF,cAAA;YAAA;YAAA;cAAA,OAAA2F,SAAA,CAAAL,IAAA;UAAA;QAAA,GAAAE,QAAA;MAAA;IAEA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}